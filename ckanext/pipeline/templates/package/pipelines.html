{% extends 'package/edit_base.html' %}

{% block subtitle %}{{ _('Pipelines') }} - {{ h.dataset_display_name(pkg) }}{% endblock %}

{% set controller = 'ckanext.controllers.pipeline:ICController' %}

{% block styles %}
  {{ super() }}
  {% resource 'ic_theme/pipeline.css' %}
{% endblock %}

{% block page_primary_action %}
  {% link_for _('Assign pipeline'), controller=controller, action='choose_action', id=c.pkg_dict.name, class_='btn', icon='plus' %}
{% endblock %}

{% block primary_content_inner %}
	{% set pipelines = h.get_dataset_pipelines(c.pkg_dict['id']) %}
	{% if pipelines|length > 0 %}
		<ul class="dataset-list unstyled">
		  {% for pipe in pipelines %}
		  <li class="dataset-item">
		  	<div class="dataset-content">
		  	  <h3 class="dataset-heading">
                {{ _(pipe['name']) }} 
		      </h3>
		      <div class="dropdown btn-group">
			    <a href="#" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
			      <i class="icon-share-alt"></i>
			      Explore
			      <span class="caret"></span>
			    </a>
			    <ul class="dropdown-menu">
			      <li>
			      	<a href="{{ uv_edit_url.format(pipe_id=pipe['id']) }}" target="_blank">
			      	  <i class="icon-edit"></i>
			      	  {{ _('Configure manually') }}
			      	</a>
			      </li>
			      <li>
			      	{% link_for _('Remove'), controller=controller, action='remove_pipe', id=c.pkg_dict.name, pipeline_id=pipe['id'] %}
			      </li>
			    </ul>
			  </div>
		      <div>{{ _(pipe['description']) }}</div>
		  	</div>
		  </li>
		  {% endfor %}
		</ul>
	{% else %}
		<p>No pipelines assigned.</p>
	{% endif %}
{% endblock %}
